{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState, useEffect } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport axios from 'axios';\nimport { db, collection, add } from \"../firebase.js\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default function App() {\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    actesCulturals = _useState2[0],\n    setActesCulturals = _useState2[1];\n  var filterByDistance = function filterByDistance(data) {\n    var currentLocation = {\n      lat: 41.38879,\n      lon: 2.15899\n    };\n    var filteredData = data.filter(function (acteCultural) {\n      if (acteCultural.latitud === null || acteCultural.longitud === null || acteCultural.fi_data < new Date().toISOString().slice(0, 10)) {\n        return false;\n      }\n      var distance = getDistance(currentLocation, {\n        lat: parseFloat(acteCultural.latitud),\n        lon: parseFloat(acteCultural.longitud)\n      });\n      return distance <= 10000000;\n    });\n    return filteredData;\n  };\n  var getDistance = function getDistance(start, end) {\n    var deg2rad = function deg2rad(deg) {\n      return deg * (Math.PI / 180);\n    };\n    var R = 6371;\n    var dLat = deg2rad(end.lat - start.lat);\n    var dLon = deg2rad(end.lon - start.lon);\n    var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(deg2rad(start.lat)) * Math.cos(deg2rad(end.lat)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\n    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    var d = R * c;\n    return d;\n  };\n  useEffect(function () {\n    var currentDate = new Date();\n    var formattedDate = currentDate.toISOString().substring(0, 10);\n    axios.get('https://analisi.transparenciacatalunya.cat/resource/rhpv-yr4f.json?$where=data_fi>%27' + formattedDate + '%27').then(function () {\n      var _ref = _asyncToGenerator(function* (response) {\n        var filteredData = filterByDistance(response.data);\n        setActesCulturals(filteredData.map(function (acteCultural) {\n          return acteCultural;\n        }));\n        for (var acteCultural of filteredData) {\n          var res = yield add(collection(db, 'event'), acteCultural);\n        }\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }()).catch(function (error) {\n      console.log(error);\n    });\n  }, []);\n  return _jsx(View, {\n    style: styles.container,\n    children: actesCulturals.map(function (acteCultural, index) {\n      return _jsxs(Text, {\n        children: [acteCultural.denominaci, \" \", acteCultural.data_fi, \" \", acteCultural.localiat]\n      }, index);\n    })\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center'\n  }\n});","map":{"version":3,"names":["React","useState","useEffect","StyleSheet","Text","View","axios","db","collection","add","jsxs","_jsxs","jsx","_jsx","App","_useState","_useState2","_slicedToArray","actesCulturals","setActesCulturals","filterByDistance","data","currentLocation","lat","lon","filteredData","filter","acteCultural","latitud","longitud","fi_data","Date","toISOString","slice","distance","getDistance","parseFloat","start","end","deg2rad","deg","Math","PI","R","dLat","dLon","a","sin","cos","c","atan2","sqrt","d","currentDate","formattedDate","substring","get","then","_ref","_asyncToGenerator","response","map","res","_x","apply","arguments","catch","error","console","log","style","styles","container","children","index","denominaci","data_fi","localiat","create","flex","backgroundColor","alignItems","justifyContent"],"sources":["C:/Users/Jordi/Desktop/apiex/MiProyecto/src/ApiExample.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { StyleSheet, Text, View } from 'react-native';\r\nimport axios from 'axios';\r\nimport { db, collection, add } from '../firebase.js';\r\n\r\nexport default function App() {\r\n  const [actesCulturals, setActesCulturals] = useState([]);\r\n\r\n  const filterByDistance = (data) => {\r\n    const currentLocation = { lat: 41.38879, lon: 2.15899 }; // coordenadas de ejemplo\r\n    const filteredData = data.filter((acteCultural) => {\r\n      if (\r\n        acteCultural.latitud === null ||\r\n        acteCultural.longitud === null ||\r\n        acteCultural.fi_data < new Date().toISOString().slice(0, 10)\r\n      ) {\r\n        return false;\r\n      }\r\n      const distance = getDistance(\r\n        currentLocation,\r\n        { lat: parseFloat(acteCultural.latitud), lon: parseFloat(acteCultural.longitud) }\r\n      );\r\n      return distance <= 10000000;\r\n    });\r\n    return filteredData;\r\n  };\r\n\r\n  const getDistance = (start, end) => {\r\n    const deg2rad = (deg) => deg * (Math.PI / 180);\r\n    const R = 6371; // Earth's radius in km\r\n    const dLat = deg2rad(end.lat - start.lat);\r\n    const dLon = deg2rad(end.lon - start.lon);\r\n    const a =\r\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.cos(deg2rad(start.lat)) *\r\n        Math.cos(deg2rad(end.lat)) *\r\n        Math.sin(dLon / 2) *\r\n        Math.sin(dLon / 2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    const d = R * c;\r\n    return d;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const currentDate = new Date();\r\n    const formattedDate = currentDate.toISOString().substring(0, 10);\r\n    axios\r\n      .get('https://analisi.transparenciacatalunya.cat/resource/rhpv-yr4f.json?$where=data_fi>%27'+formattedDate+'%27')\r\n      .then(async (response) => {\r\n        const filteredData = filterByDistance(response.data);\r\n        setActesCulturals(filteredData.map((acteCultural) => acteCultural));\r\n  \r\n        // Guarda los datos en Firebase\r\n        for (let acteCultural of filteredData) {\r\n          const res = await add(collection(db, 'event'), acteCultural);\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n  }, []);\r\n  \r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      {actesCulturals.map((acteCultural, index) => (\r\n        <Text key={index}>{acteCultural.denominaci} {acteCultural.data_fi} {acteCultural.localiat}</Text>\r\n      ))}\r\n    </View>\r\n  );\r\n}\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n});\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}